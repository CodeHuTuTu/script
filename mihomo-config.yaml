# ==============================================================================
# Mihomo (Clash Meta) Configuration - Best Practices 2026
# ==============================================================================

# ------------------------------------------------------------------------------
# 1. åŸºç¡€è®¾ç½®
# ------------------------------------------------------------------------------
port: 7890
socks-port: 7891
mixed-port: 7892
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: true
external-controller: 0.0.0.0:9090

# ------------------------------------------------------------------------------
# 2. DNS è®¾ç½® (é˜²æ³„éœ²æ ¸å¿ƒ)
# ------------------------------------------------------------------------------
dns:
  enable: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'
  
  # é»˜è®¤ DNS (ç”¨äºé IP åˆ†æµçš„å…œåº•è§£æï¼Œé€šå¸¸ä½¿ç”¨åŠ å¯† DNS)
  nameserver:
    - 'https://dns.google/dns-query'
    - 'https://cloudflare-dns.com/dns-query'

  # ç›´è¿ DNS (ç”¨äºå›½å†…åŸŸåè§£æï¼ŒåŠ å¿«é€Ÿåº¦å¹¶åˆ©ç”¨ CDN)
  # ä½¿ç”¨ nameserver-policy è¿›è¡Œç²¾å‡†åˆ†æµ
  nameserver-policy:
    "geosite:cn,private":
      - 'https://dns.alidns.com/dns-query'
      - 'https://doh.pub/dns-query'

# ------------------------------------------------------------------------------
# 3. å—…æ¢è®¾ç½® (è¾…åŠ©åˆ†æµ)
# ------------------------------------------------------------------------------
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
    QUIC:
      ports: [443, 8443]

# ------------------------------------------------------------------------------
# 4. ä»£ç†æä¾›å•† (æœºåœºè®¢é˜…)
# ------------------------------------------------------------------------------
proxy-providers:
  MyAirport:
    type: http
    # æ›¿æ¢ä¸‹é¢çš„ URL ä¸ºæ‚¨çš„è®¢é˜…åœ°å€
    url: "https://example.com/api/v1/client/subscribe?token=YOUR_TOKEN"
    interval: 3600
    path: ./proxies/airport.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

# ------------------------------------------------------------------------------
# 5. æ‰‹åŠ¨èŠ‚ç‚¹ (VLESS/VMess/Hysteria2 ç­‰)
# ------------------------------------------------------------------------------
proxies:
  # ç¤ºä¾‹ VLESS èŠ‚ç‚¹
  - name: "Myself-VLESS"
    type: vless
    server: 1.2.3.4
    port: 443
    uuid: your-uuid-here
    network: ws
    tls: true
    udp: true
    servername: example.com
    ws-opts:
      path: /ws
      headers:
        Host: example.com

  # ç¤ºä¾‹ Hysteria2 èŠ‚ç‚¹
  - name: "Myself-Hy2"
    type: hysteria2
    server: 1.2.3.4
    port: 443
    password: your-password
    sni: example.com
    skip-cert-verify: false

# ------------------------------------------------------------------------------
# 6. ç­–ç•¥ç»„ (åœ°åŸŸåˆ†æµä¸ç­›é€‰)
# ------------------------------------------------------------------------------
proxy-groups:
  # === ä¸»é€‰æ‹©ç»„ ===
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
      - ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
      - ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
      - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
      - ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
      - ğŸŒ å…¶ä»–èŠ‚ç‚¹
      - Myself-VLESS
      - Myself-Hy2

  # === è‡ªåŠ¨æµ‹é€Ÿ ===
  - name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - MyAirport
    proxies:
      - Myself-VLESS
      - Myself-Hy2

  # === åœ°åŸŸåˆ†ç»„ (æ­£åˆ™è¿‡æ»¤) ===
  - name: ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - MyAirport
    # è¿‡æ»¤å…³é”®è¯: æ¸¯, HK, Hong Kong (å¿½ç•¥å¤§å°å†™)
    filter: "(?i)æ¸¯|HK|Hong Kong"

  - name: ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - MyAirport
    # è¿‡æ»¤å…³é”®è¯: æ—¥æœ¬, JP, Japan
    filter: "(?i)æ—¥æœ¬|JP|Japan"

  - name: ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - MyAirport
    # è¿‡æ»¤å…³é”®è¯: ç¾, US, United States
    filter: "(?i)ç¾|US|United States"

  - name: ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - MyAirport
    # è¿‡æ»¤å…³é”®è¯: æ–°, SG, Singapore
    filter: "(?i)æ–°|SG|Singapore"

  - name: ğŸ‡¹ğŸ‡¼ å°æ¹¾èŠ‚ç‚¹
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - MyAirport
    # è¿‡æ»¤å…³é”®è¯: å°, TW, Taiwan
    filter: "(?i)å°|TW|Taiwan"

  # === å…¶ä»–èŠ‚ç‚¹ (åå‘åŒ¹é…) ===
  # è¯´æ˜: åŒ¹é…æ‰€æœ‰ä¸åŒ…å«ä¸Šè¿°åœ°åŸŸå…³é”®è¯çš„èŠ‚ç‚¹
  - name: ğŸŒ å…¶ä»–èŠ‚ç‚¹
    type: select
    use:
      - MyAirport
    # æ­£åˆ™é€»è¾‘: æ’é™¤æ‰€æœ‰ä¸»æµåœ°åŒºï¼Œå‰©ä¸‹çš„å½’ä¸º Other
    filter: "(?i)^(?!.*(?:æ¸¯|HK|Hong Kong|æ—¥æœ¬|JP|Japan|ç¾|US|United States|æ–°|SG|Singapore|å°|TW|Taiwan)).*"

  # === åŠŸèƒ½åˆ†ç»„ ===
  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT

  - name: ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - DIRECT

# ------------------------------------------------------------------------------
# 7. è§„åˆ™é›†æä¾›å•† (Rule Providers) - ä½¿ç”¨ MetaCubeX ä»“åº“
# ------------------------------------------------------------------------------
rule-providers:
  # å¹¿å‘Šè§„åˆ™
  ads:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geosite/category-ads-all.mrs"
    path: ./ruleset/ads.mrs
    interval: 86400

  # å›½å†…åŸŸå
  cn_domain:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geosite/cn.mrs"
    path: ./ruleset/cn_domain.mrs
    interval: 86400

  # å›½å¤–å¸¸è§åº”ç”¨ (Google, Telegram, Twitter ç­‰)
  geolocation-!cn:
    type: http
    behavior: domain
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geosite/geolocation-!cn.mrs"
    path: ./ruleset/geolocation-!cn.mrs
    interval: 86400
  
  # å›½å†… IP
  cn_ip:
    type: http
    behavior: ipcidr
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/release/geoip/cn.mrs"
    path: ./ruleset/cn_ip.mrs
    interval: 86400

# ------------------------------------------------------------------------------
# 8. è§„åˆ™ç­–ç•¥ (Rules)
# ------------------------------------------------------------------------------
rules:
  # 1. è§„åˆ™é›†æ‹¦æˆª
  - RULE-SET,ads,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
  
  # 2. å±€åŸŸç½‘/ç§æœ‰åœ°å€ç›´è¿
  - GEOSITE,private,DIRECT
  - GEOIP,private,DIRECT,no-resolve

  # 3. å›½å†…æµé‡ç›´è¿ (DNS é˜²æ³„éœ²å…³é”®)
  - RULE-SET,cn_domain,DIRECT
  - RULE-SET,cn_ip,DIRECT

  # 4. å›½å¤–å¸¸è§åº”ç”¨èµ°çš„ä»£ç†
  - RULE-SET,geolocation-!cn,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # 5. å…œåº•è§„åˆ™
  - GEOIP,cn,DIRECT  # æœ€åçš„ GeoIP ä¸­å›½å…œåº•
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
